<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link rel="stylesheet" href="sidebar2.css" />
    <link rel="stylesheet" href="header.css" />
    <link rel="stylesheet" href="dashboard.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/swiper/swiper-bundle.min.css"
    />
    <link rel="stylesheet" href="dashboard_card.css" />
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  </head>
  <body>
    <header class="header">
      <div class="left">
        <span class="logo">D R A K Z</span>
      </div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input
          type="text"
          id="searchInput"
          placeholder="Search for something"
          onkeyup="filterDashboard()"
        />
      </div>
      <div class="icons">
        <button
          id="premiumButton"
          class="premium-btn"
          style="
            display: none;
            background-color: #ffd700;
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
          "
          onclick="upgradeToPremium()"
        >
          Upgrade to Premium
        </button>
        <i class="fas fa-bell"></i>
        <div class="profile" onclick="window.location.href='settings.html';">
          <img
            src="https://randomuser.me/api/portraits/women/44.jpg"
            alt="User"
          />
        </div>
      </div>
    </header>

    <div class="main-container">
      <div class="sidebar" id="mySidebar">
        <!-- Close Button (visible when sidebar is open) -->
        <a
          href="javascript:void(0)"
          class="closebtn"
          id="close-button"
          onclick="closeNav()"
        >
          <img width="25" src="assets/icons/sidebarclose.png" />
        </a>

        <ul class="sidebar-list">
          <a href="#">
            <li class="active">
              <i class="fas fa-home"></i> <span>Dashboard</span>
            </li>
          </a>
          <a href="accounts.html">
            <li><i class="fas fa-user"></i> <span>Accounts</span></li>
          </a>
          <a href="investments.html">
            <li>
              <i class="fa-solid fa-chart-column"></i> <span>Investments</span>
            </li>
          </a>
          <a href="credit_cards.html">
            <li>
              <i class="fas fa-credit-card"></i> <span>Credit Cards</span>
            </li>
          </a>
           <a href="blog.html">
            <li><i class="fa-solid fa-blog"></i> <span>Blog</span></li>
          </a>
           <a href="services.html">
            <li><i class="fas fa-tools"></i> <span>Services</span></li>
          </a> 
          <a href="My_privilege.html">
            <li><i class="fas fa-gift"></i> <span>My Privileges</span></li>
           </a>
          <a href="drakz_chatbot.html">
            <li><i class="fas fa-robot"></i> <span>FinBot</span></li>
          </a>
          <a href="settings.html">
            <li><i class="fas fa-cog"></i> <span>Settings</span></li>
          </a> 
        </ul>
      </div>

      <!-- Main Content -->
      <div class="content" id="main">
        <div class="video-library dashboard-item">
          <h3>Video Library</h3>

          <div class="navigation-arrows">
            <button class="nav-arrow left-arrow">&larr;</button>
            <button class="nav-arrow right-arrow">&rarr;</button>
          </div>

          <!-- Scrollable Video Row -->
          <div class="video-row">
            <a
              href="#"
              class="video-thumbnail"
              data-video="https://www.youtube.com/embed/ouvbeb2wSGA?autoplay=1"
            >
              <img
                src="https://img.youtube.com/vi/ouvbeb2wSGA/hqdefault.jpg"
                alt="Video 1"
              />
            </a>

            <a
              href="#"
              class="video-thumbnail"
              data-video="https://www.youtube.com/embed/iCzBVWdNOeE?autoplay=1"
            >
              <img
                src="https://img.youtube.com/vi/iCzBVWdNOeE/hqdefault.jpg"
                alt="Video 2"
              />
            </a>

            <a
              href="#"
              class="video-thumbnail"
              data-video="https://www.youtube.com/embed/57kzsve3h0U?autoplay=1"
            >
              <img
                src="https://img.youtube.com/vi/57kzsve3h0U/hqdefault.jpg"
                alt="Video 3"
              />
            </a>

            <a
              href="#video3"
              class="video-thumbnail"
              data-video="https://www.youtube.com/embed/b7MeUxcHQCs?autoplay=1"
            >
              <img
                src="https://img.youtube.com/vi/b7MeUxcHQCs/hqdefault.jpg"
                alt="Video 3"
              />
            </a>
            <a
              href="#video4"
              class="video-thumbnail"
              data-video="https://www.youtube.com/embed/5pYeoZaoWrA?autoplay=1"
            >
              <img
                src="https://img.youtube.com/vi/5pYeoZaoWrA/hqdefault.jpg"
                alt="Video 1"
              />
            </a>
            <a
              href="#video5"
              class="video-thumbnail"
              data-video="https://www.youtube.com/embed/qu47ulGpHDo?autoplay=1"
            >
              <img
                src="https://img.youtube.com/vi/qu47ulGpHDo/hqdefault.jpg"
                alt="Video 2"
              />
            </a>
          </div>

          <div class="video-preview" id="video-modal">
            <a href="#" class="close-preview">&times;</a>
            <iframe id="video-frame" src="" allowfullscreen></iframe>
          </div>
        </div>
        <div class="credit-score dashboard-item">
          <div class="credit-score-header"><b>Credit Score</b></div>
          <div class="gauge-container">
            <div class="ticks"></div>
            <div class="gauge-ring">
              <div class="gauge-value"></div>
              <div class="gauge-change">
                <span class="arrow">&#9660;</span>
                <span>20</span>
              </div>
            </div>
          </div>
          <div class="credit-score-container">
            <div class="credit-score-bar">
              <div class="credit-score-marker" style="left: 78.8%"></div>
              <span class="credit-score-value" style="left: 78.8%">670</span>
            </div>
            <div class="credit-score-labels">
              <span>300</span>
              <span>485</span>
              <span>670</span>
              <span>850</span>
            </div>
            <div class="good">
              <span class="credit-score-status">GOOD</span>
            </div>
          </div>
        </div>

        <div class="chart-box dashboard-item">
          <h2>Expense Distribution</h2>
          <canvas id="expenseChartCanvas"></canvas>
          <div class="legend" id="chartLegend"></div>
        </div>

        <div class="atm-cards-container">
          <div class="atm-cards-header">
            <h3>My Cards</h3>
            <!-- Add Card Button -->
            <button class="add-card-button" onclick="showForm()">
              Add Card
            </button>
          </div>

          <!-- Swiper Container -->
          <div class="swiper-container">
            <div class="swiper-wrapper">
              <!-- Slide 1 -->
              <div class="swiper-slide">
                <div class="atm-card">
                  <img
                    src="assets/images/bank-iconn.png"
                    alt="Bank Logo"
                    class="bank-logo"
                  />
                  <img
                    src="https://cdn-icons-png.flaticon.com/128/9334/9334627.png"
                    alt="Chip"
                    class="chip"
                  />
                  <div class="card-number">1234 5678 9012 3456</div>
                  <div class="validity">
                    <div>
                      <span>VALID FROM</span><br /><strong>01/23</strong>
                    </div>
                    <div>
                      <span>VALID THRU</span><br /><strong>12/30</strong>
                    </div>
                  </div>
                  <div class="cardholder-name">JANE DOE</div>
                  <img
                    src="https://cdn-icons-png.flaticon.com/128/5968/5968299.png"
                    alt="VISA Logo"
                    class="visa-logo"
                  />
                  <button class="delete-button" onclick="deleteCard(this)">
                    Ã—
                  </button>
                </div>
              </div>
            </div>

            <!-- No Cards Message -->
            <div id="noCardsMessage" class="no-cards-message">No Cards</div>

            <!-- Pagination (Indicators) -->
            <div class="swiper-pagination"></div>

            <!-- Navigation Arrows -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
          </div>

          <!-- Add Card Form -->
          <div class="overlay" id="overlay"></div>

          <div class="add-card-form" id="addCardForm">
            <img class="form-bg" src="#" />
            <div class="form-heading"><h3>Add New Card</h3></div>
            <input
              type="text"
              id="cardNumber"
              placeholder="Card Number"
              required
              maxlength="19"
              oninput="formatCardNumber(this)"
            />
            <input
              type="text"
              id="cardName"
              placeholder="Name on Card"
              required
            />
            <div class="bank-input-container">
              <input
                type="text"
                id="bankName"
                placeholder="Bank"
                list="bankList"
                required
              />
              <datalist id="bankList">
                <option value="State Bank of India"></option>
                <option value="HDFC Bank"></option>
                <option value="ICICI Bank"></option>
                <option value="Axis Bank"></option>
                <option value="Kotak Mahindra Bank"></option>
                <option value="Punjab National Bank"></option>
                <option value="Bank of Baroda"></option>
                <option value="Canara Bank"></option>
                <option value="Union Bank of India"></option>
                <option value="IndusInd Bank"></option>
              </datalist>
            </div>
            <div class="card-type-container">
              <select id="cardType" required>
                <option value="" disabled selected>Select Card Type</option>
                <option value="credit">Credit Card</option>
                <option value="debit">Debit Card</option>
              </select>
            </div>
            <input
              type="text"
              id="validFrom"
              placeholder="Valid From (MM/YY)"
              required
              maxlength="5"
              oninput="formatDate(this)"
            />
            <input
              type="text"
              id="validThru"
              placeholder="Valid Thru (MM/YY)"
              required
              maxlength="5"
              oninput="formatDate(this)"
            />
            <div class="button-div">
              <button type="button" onclick="addCard()">Add Card</button>
            </div>
          </div>
        </div>

         <div class="chat-container">
          <div class="chat-header">
            <span class="chat-header-icon">ðŸ’¬</span>
            ChatBox
          </div>
          <div class="header-divider"></div>
          <div class="messages-container">
            
            <div class="message bot">Hi there! How can I help you today?</div>
            <div class="message user">
              Just checking out this chat interface!
            </div>
          </div>
          <div class="input-area">
            <textarea placeholder="Type your message..."></textarea>
            <button class="send-btn">âž¤</button>
          </div>
        </div> 
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="dashboard.js"></script>
    <script>
      (function () {
        // Store our chart instance
        let myExpenseChart = null;

        // Main function to create chart
        function createExpenseChart(expenseData) {
          // Get the canvas
          const canvas = document.getElementById("expenseChartCanvas");
          if (!canvas) {
            console.error("Canvas not found!");
            return;
          }

          // Make sure Chart.js is available
          if (typeof Chart === "undefined") {
            console.error(
              "Chart.js is not loaded! Please include it in your HTML."
            );
            return;
          }

          // Set canvas dimensions
          canvas.style.width = "400px";
          canvas.style.height = "300px";
          canvas.width = 400;
          canvas.height = 300;

          // Process the expense data
          const categories = {};

          // Check that we have valid expense data
          if (
            !expenseData ||
            !Array.isArray(expenseData) ||
            expenseData.length === 0
          ) {
            console.error("No valid expense data provided");
            return;
          }

          // Group expenses by category
          expenseData.forEach((expense) => {
            const category = expense.category;
            const amount = parseFloat(expense.amount);

            if (!isNaN(amount)) {
              if (categories[category]) {
                categories[category] += amount;
              } else {
                categories[category] = amount;
              }
            }
          });

          const categoryNames = Object.keys(categories);
          const categoryAmounts = categoryNames.map((name) => categories[name]);

          // Define chart colors
          const chartColors = [
            "#4a6b97",
            "rgb(101, 79, 113)",
            "rgb(222, 132, 132)",
            "#4BC0C0",
            "#9966FF",
            "rgb(177, 169, 123)",
            "#C9CBCF",
          ];

          // Get the context
          const ctx = canvas.getContext("2d");

          // Destroy existing chart if it exists
          if (myExpenseChart) {
            myExpenseChart.destroy();
          }

          // Create a simple chart
          myExpenseChart = new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: categoryNames,
              datasets: [
                {
                  data: categoryAmounts,
                  backgroundColor: chartColors.slice(0, categoryNames.length),
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
            },
          });

          console.log("Chart created successfully");

          // Create a simple legend
          createSimpleLegend(categoryNames, categoryAmounts, chartColors);
        }

        // Create a simple legend
        function createSimpleLegend(categories, amounts, colors) {
          const legendEl = document.getElementById("chartLegend");
          if (!legendEl) return;

          // Clear previous legend
          legendEl.innerHTML = "";

          const total = amounts.reduce((sum, amount) => sum + amount, 0);

          // Create legend items
          categories.forEach((category, i) => {
            const percent = Math.round((amounts[i] / total) * 100);
            const item = document.createElement("div");
            item.style.margin = "5px 0";
            item.style.display = "flex";
            item.style.alignItems = "center";

            const colorBox = document.createElement("span");
            colorBox.style.display = "inline-block";
            colorBox.style.width = "12px";
            colorBox.style.height = "12px";
            colorBox.style.backgroundColor = colors[i];
            colorBox.style.marginRight = "8px";

            const text = document.createElement("span");
            text.textContent = `${category}: $${amounts[i].toFixed(
              2
            )} (${percent}%)`;

            item.appendChild(colorBox);
            item.appendChild(text);
            legendEl.appendChild(item);
          });
        }

        // Function to extract data from the global scope
        function initializeFromGlobalData() {
          // Try to find the data in the page
          
          if (window.dashboardData && window.dashboardData.expenses) {
            console.log("Found dashboard data in window.dashboardData");
            createExpenseChart(window.dashboardData.expenses);
            return true;
          }
        }

        // Initialize when document is ready
        if (
          document.readyState === "complete" ||
          document.readyState === "interactive"
        ) {
          setTimeout(initializeFromGlobalData, 1000); // Delay to ensure data is loaded
        } else {
          document.addEventListener("DOMContentLoaded", function () {
            setTimeout(initializeFromGlobalData, 1000);
          });
        }

        // Also expose a global function to manually trigger chart creation
        window.manuallyCreateExpenseChart = function (data) {
          console.log("Manually creating chart with data:", data);
          createExpenseChart(data);
        };
      });
    </script>
  </body>
</html>
